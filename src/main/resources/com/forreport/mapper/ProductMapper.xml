<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.forreport.mapper.ProductMapper">

	<!-- 소분류 선택 여부에 따라 서로 다른 쿼리문 입력 -->
	<sql id="getListAboutCategory">
		<choose>
			<!-- smallCategory 선택 안한 경우 -->
			<when test="smallCategory==999">
				<![CDATA[
					largeCa = #{largeCategory} and
					rownum <= #{pageNum} * #{amount}
				]]>	
			</when>
			<when test="smallCategory!=999">
				<![CDATA[
					largeCa = #{largeCategory} and
					smallCa = #{smallCategory} and
					rownum <= #{pageNum} * #{amount}
				]]>	
			</when>
		
		</choose>
	</sql>

	<select id="getProductListWithPaging" resultType="com.forreport.domain.ProductVO">
		<![CDATA[	
			select
				pronum, id, largeCa, smallCa, title, proname, prodsc, price, uploadDate, approval
			from (
					select
						rownum rn, pronum, id, largeCa, smallCa, title, proname, prodsc, price, uploadDate, approval
					from
						tbl_product
					where
		]]>
		<include refid="getListAboutCategory"/>
		<![CDATA[
				)
			where
				rn > (#{pageNum}-1) * #{amount}
		]]>		
	</select>

</mapper>